"use strict";function handleAjax(e){e.url&&(e.msg+="，页面即将跳转～"),1==e.code?updateAlert(e.msg,"success"):updateAlert(e.msg,"danger");"refresh"==e.url?setTimeout(function(){location.href=location.href},1500):e.url&&setTimeout(function(){location.href=e.url},1500)}$(function(){$(".ajax-get").click(function(){var e,t=this;return $(this).hasClass("confirm")&&!confirm("确认要执行该操作吗?")||((e=$(this).attr("href"))||(e=$(this).attr("url")))&&$.get(e).success(function(e){1==e.code?(e.url?updateAlert(e.msg+" 页面即将自动跳转~","success"):updateAlert(e.msg,"success"),setTimeout(function(){e.url?location.href=e.url:$(t).hasClass("no-refresh")?$("#top-alert").find("button").click():location.reload()},3e3)):(updateAlert(e.msg),setTimeout(function(){e.url?location.href=e.url:$("#top-alert").find("button").click()},15e3))}),!1}),$(".ajax-post").click(function(){var e,t,i;toast.showLoading();var n=$(this).attr("target-form"),s=this,r=!1;if("submit"==$(this).attr("type")||(e=$(this).attr("href"))||(e=$(this).attr("url"))){if(i=$("."+n),"true"===$(this).attr("hide-data"))t=(i=$(".hide-data")).serialize();else{if(null==i.get(0))return updateAlert("没有可操作数据。","danger"),!1;if("FORM"==i.get(0).nodeName){if($(this).hasClass("confirm"))if(a=(a=$(s).attr("confirm-info"))||"确认要执行该操作吗?",!confirm(a))return!1;e=void 0!==$(this).attr("url")?$(this).attr("url"):i.get(0).action,t=i.serialize()}else if("INPUT"==i.get(0).nodeName||"SELECT"==i.get(0).nodeName||"TEXTAREA"==i.get(0).nodeName){if(i.each(function(e,t){"checkbox"==t.type&&1==t.checked&&(r=!0)}),r&&$(this).hasClass("confirm"))if(a=(a=$(s).attr("confirm-info"))||"确认要执行该操作吗?",!confirm(a))return!1;t=i.serialize()}else{var a;if($(this).hasClass("confirm"))if(a=(a=$(s).attr("confirm-info"))||"确认要执行该操作吗?",!confirm(a))return!1;t=i.find("input,select,textarea").serialize()}}if(""==t&&"true"!=$(this).attr("hide-data"))return updateAlert("请勾选操作对象!。","danger"),!1;$(s).addClass("disabled").attr("autocomplete","off").prop("disabled",!0),$.post(e,t).success(function(e){toast.hideLoading(),1==e.code?(e.url?updateAlert(e.msg+" 页面即将自动跳转~","success"):updateAlert(e.msg,"success"),setTimeout(function(){e.url?location.href=e.url:$(s).hasClass("no-refresh")?($("#top-alert").find("button").click(),$(s).removeClass("disabled").prop("disabled",!1)):location.reload()},1500)):(updateAlert(e.msg,"error"),setTimeout(function(){e.url?location.href=e.url:($("#top-alert").find("button").click(),$(s).removeClass("disabled").prop("disabled",!1))},1500))})}return!1})}),function(n,e,t){if(void 0===n)throw new Error("muu requires jQuery");n.muu||(n.muu=function(e){n.isPlainObject(e)&&n.extend(n.muu,e)});var s=function(){n(".nav-type").unbind("change"),n(".nav-type").change(function(){var e=n(this);switch(e.val()){case"module":e.closest("li>div").children("select.module").show().change(),e.closest("li>div").children("input.url").hide();break;case"custom":e.closest("li>div").children("select.module").hide(),e.closest("li>div").children("input.url").show(),e.closest("li>div").children("input.title").val(""),e.closest("li>div").children("input.url").val("")}}),n(".module").unbind("change"),n(".module").change(function(){var e=n(this),t=e.find("option:selected").text(),i=e.val();e.closest("li>div").children("input.title").val(t),e.closest("li>div").children("input.url").val(i),e.closest("li>div").next().children("select.chosen-icons").attr("data-value","icon-"+e.find("option:selected").data("icon")),s()}),n(".add-new").unbind("click"),n(".add-new").click(function(){n(".channel-ul").append(n("#one-nav").html()),s()}),n(".add-one").unbind("click"),n(".add-one").click(function(){n(this).closest(".pLi").after(n("#one-nav").html()),s()}),n(".add-two").unbind("click"),n(".add-two").click(function(){n(this).closest("li").after(n("#two-nav").html()),s()}),n(".remove-li").unbind("click"),n(".remove-li").click(function(){1<n(this).parents("form").find(".pLi").length?(n(this).closest("li").remove(),s()):updateAlert("不能再减了~")}),n(".add-child").unbind("click"),n(".add-child").click(function(){0==n(this).closest("li").find(".ul-2").length&&n(this).closest("li").append('<div class="clearfix"></div><ul class="ul-2"  style="display: block;"></ul>'),n(this).closest("li").find(".ul-2").prepend(n("#two-nav").html()),s()}),n(".channel-ul .pLi").each(function(e,t){n(this).attr("data-id",e),n(this).find(".sort").val(n(this).attr("data-order"))}),n(".ul-2 li").each(function(e,t){n(this).find(".pid").val(n(this).parents(".pLi").attr("data-id")),n(this).find(".sort").val(n(this).attr("data-order"))}),n(".target").change(function(){n(this).closest(".new-blank").find(".target_input").val(n(this).is(":checked")?1:0)})};s();n.muu({channel_sort:function(){n(".channel-ul").sortable({trigger:".sort-handle-1",selector:"li",dragCssClass:"",finish:function(){s()}}),n(".channel-ul .ul-2").sortable({trigger:".sort-handle-2",selector:"li",dragCssClass:"",finish:function(){s()}})},channel_bind_color:function(){n(".simpleColorContainer").remove(),n(".simple_color_callback").simpleColor({boxWidth:15,boxHeight:15,cellWidth:15,cellHeight:15,chooserCSS:{"z-index":1200},displayCSS:{border:0}})}})}(jQuery,window),$(function(){$(".check-all").click(function(){$(".ids").prop("checked",this.checked)}),$(".ids").click(function(){$(".ids").each(function(e){if(!this.checked)return $(".check-all").prop("checked",!1),!1;$(".check-all").prop("checked",!0)})}),$(".text").focus(function(){$(this).addClass("focus")}).blur(function(){$(this).removeClass("focus")}),$("textarea").focus(function(){$(this).closest(".textarea").addClass("focus")}).blur(function(){$(this).closest(".textarea").removeClass("focus")})});var admin_image={removeImage:function(e,t){this.upAttachVal("del",t,e),e.parents(".each").remove()},upAttachVal:function(e,t,i){var n=i.parents(".controls").find(".attach"),s=n.val().split(","),r=[];for(var a in s)""!==s[a]&&s[a]!==t.toString()&&r.push(s[a]);return"add"===e&&r.push(t),n.val(r.join(",")),r}};window.updateAlert=function(e,t){if(void 0!==t)var i=$.zui.messager.show(e,{placement:"bottom",type:t});else i=$.zui.messager.show(e,{placement:"bottom"});i.show()};var moduleManager={install:function(e){$.post(Url("admin/module/install"),{id:e},function(e){handleAjax(e)})},uninstall:function(e){$.post(Url("admin/module/uninstall"),{id:e},function(e){handleAjax(e)})}};function Url(e,t,i){var n="/index.php";return""!=(e=e.split("/"))[0]&&"@"!=e[0]||(e[0]=APPNAME),e[1]||(e[1]="Index"),e[2]||(e[2]="index"),n=n+"?s=/"+e[0]+"/"+e[1]+"/"+e[2],t&&(n=n+"/"+(t=t.join("/"))),i||(n+=".html"),n}var toast={success:function(e){toast.show(e,{placement:"center",type:"success",close:!0})},error:function(e){toast.show(e,{placement:"center",type:"danger",close:!0})},info:function(e){toast.show(e,{placement:"center",type:"info",close:!0})},warning:function(e,t){toast.show(e,{placement:"center",type:"warning",close:!0})},show:function(e,t){$.zui?$.zui.messager.show(e,t):$.messager.show(e,t)},showLoading:function(){$("body").append('<div class="big_loading"><img src="/static/common/images/big_loading.gif"/></div>')},hideLoading:function(){$("div").remove(".big_loading")}};!function(a){var e=window.Think={};e||a.error("ThinkPHP基础配置没有正确加载！"),e.parse_url=function(e){var t=e.match(/^(?:([a-z]+):\/\/)?([\w-]+(?:\.[\w-]+)+)?(?::(\d+))?([\w-\/]+)?(?:\?((?:\w+=[^#&=\/]*)?(?:&\w+=[^#&=\/]*)*))?(?:#([\w-]+))?$/i);return t||a.error("url格式不正确！"),{scheme:t[1],host:t[2],port:t[3],path:t[4],query:t[5],fragment:t[6]}},e.parse_str=function(e){var t,i=e.split("&"),n={};for(val in i)n[(t=i[val].split("="))[0]]=t[1];return n},e.parse_name=function(e,t){return t?(e.replace(/_([a-z])/g,function(e,t){return t.toUpperCase()}),e.replace(/[a-z]/,function(e){return e.toUpperCase()})):0===(e=e.replace(/[A-Z]/g,function(e){return"_"+e.toLowerCase()})).indexOf("_")&&(e=e.substr(1)),e},e.Url=function(e,t,i){var n=this.parse_url(e),s=[],r={};return n.path||a.error("url格式错误！"),0===(e=n.path).indexOf("/")?(0==this.MODEL[0]&&a.error("该URL模式不支持使用路由!("+e+")"),"/"==e.substr(-1)&&(e=e.substr(0,e.length-1)),e="/"+(e="/"==this.DEEP?e.substr(1):e.substr(1).replace(/\//g,this.DEEP))):((s=[(s=e.split("/")).pop(),s.pop(),s.pop()].reverse())[1]||a.error("ThinkPHP.Url("+e+")没有指定控制器"),s[0]&&(r[this.VAR[0]]=this.MODEL[1]?s[0].toLowerCase():s[0]),r[this.VAR[1]]=this.MODEL[1]?this.parse_name(s[1]):s[1],r[this.VAR[2]]=s[2].toLowerCase(),e="?"+a.param(r)),"string"==typeof t?t=this.parse_str(t):a.isPlainObject(t)||(t={}),n.query&&a.extend(t,this.parse_str(n.query)),t&&(e+="&"+a.param(t)),0!=this.MODEL[0]&&(e=e.replace("?"+(s[0]?this.VAR[0]:this.VAR[1])+"=","/").replace("&"+this.VAR[1]+"=",this.DEEP).replace("&"+this.VAR[2]+"=",this.DEEP).replace(/(\w+=&)|(&?\w+=$)/g,"").replace(/[&=]/g,this.DEEP),!1!==i&&(i=i||this.MODEL[2].split("|")[0])&&(e+="."+i)),e=this.APP+e},e.setValue=function(e,t){var i,n,s=e.substr(0,1),r=0;if(""!==t)if((i=a("#"===s||"."===s?e:"[name='"+e+"']")).eq(0).is(":radio"))i.filter("[value='"+t+"']").each(function(){this.checked=!0});else if(i.eq(0).is(":checkbox"))for(a.isArray(t)?n=t:(n=new Array)[0]=t,r=0,len=n.length;r<len;r++)i.filter("[value='"+n[r]+"']").each(function(){this.checked=!0});else i.val(t)}}(jQuery);