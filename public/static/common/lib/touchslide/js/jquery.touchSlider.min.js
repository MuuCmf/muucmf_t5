"use strict";!function(_){_.fn.touchSlider=function(t){t.supportsCssTransitions=function(t){for(var s=["Webkit","Moz","Ms"],i=0,e=s.length;i<e;i++)if(void 0!==t[s[i]+"Transition"])return!0;return!1}(document.createElement("div").style),t=jQuery.extend({roll:!0,flexible:!1,btn_prev:null,btn_next:null,paging:null,speed:5,view:1,range:.15,page:1,transition:!1,initComplete:null,counter:null,multi:!1},t);var s;return s=_.extend({},_.fn.touchSlider.defaults,t),this.each(function(){_.fn.extend(this,i);var t=this;this.opts=s,this._view=this.opts.view,this._speed=this.opts.speed,this._tg=_(this),this._list=this._tg.children().children(),this._width=parseInt(this._tg.css("width")),this._item_w=parseInt(this._list.css("width")),this._len=this._list.length,this._range=this.opts.range*this._width,this._pos=[],this._start=[],this._startX=0,this._startY=0,this._left=0,this._top=0,this._drag=!1,this._scroll=!1,this._btn_prev,this._btn_next,this.init(),_(this).bind("touchstart",this.touchstart).bind("touchmove",this.touchmove).bind("touchend",this.touchend).bind("dragstart",this.touchstart).bind("drag",this.touchmove).bind("dragend",this.touchend),_(window).bind("orientationchange resize",function(){t.resize(t)})})};var i={init:function(){var i=this;_(this).children().css({width:this._width+"px",overflow:"visible"}),this.opts.flexible&&(this._item_w=this._width/this._view),this.opts.roll&&(this._len=Math.ceil(this._len/this._view)*this._view);for(var t=1<this.opts.page&&this.opts.page<=this._len?(this.opts.page-1)*this._item_w:0,s=0;s<this._len;++s)this._pos[s]=this._item_w*s-t,this._start[s]=this._pos[s],this._list.eq(s).css({float:"none",display:"block",position:"absolute",top:"0",left:this._pos[s]+"px",width:this._item_w+"px"}),this.opts.supportsCssTransitions&&this.opts.transition&&this._list.eq(s).css({"-moz-transition":"0ms","-moz-transform":"","-ms-transition":"0ms","-ms-transform":"","-webkit-transition":"0ms","-webkit-transform":"",transition:"0ms",transform:""});this.opts.btn_prev&&this.opts.btn_next&&(this.opts.btn_prev.bind("click",function(){return i.animate(1,!0),!1}),this.opts.btn_next.bind("click",function(){return i.animate(-1,!0),!1})),this.opts.paging&&_(this._list).each(function(s,t){i.opts.paging.eq(s).bind("click",function(t){return i.go_page(s,t),!1})}),this.counter(),this.initComplete()},initComplete:function(){"function"==typeof this.opts.initComplete&&this.opts.initComplete(this)},resize:function(t){if(t.opts.flexible){var s=t._item_w;t._width=parseInt(t._tg.css("width")),t._item_w=t._width/t._view,t._range=t.opts.range*t._width;for(var i=0;i<t._len;++i)t._pos[i]=t._pos[i]/s*t._item_w,t._start[i]=t._start[i]/s*t._item_w,t._list.eq(i).css({left:t._pos[i]+"px",width:t._item_w+"px"}),this.opts.supportsCssTransitions&&this.opts.transition&&t._list.eq(i).css({"-moz-transition":"0ms","-moz-transform":"","-ms-transition":"0ms","-ms-transform":"","-webkit-transition":"0ms","-webkit-transform":"",transition:"0ms",transform:""})}this.counter()},touchstart:function(t){if("touchstart"==t.type&&t.originalEvent.touches.length<=1||"dragstart"==t.type){this._startX=t.pageX||t.originalEvent.touches[0].pageX,this._startY=t.pageY||t.originalEvent.touches[0].pageY,this._scroll=!1,this._start=[];for(var s=0;s<this._len;++s)this._start[s]=this._pos[s]}},touchmove:function(t){if("touchmove"==t.type&&t.originalEvent.touches.length<=1||"drag"==t.type){this._left=(t.pageX||t.originalEvent.touches[0].pageX)-this._startX,this._top=(t.pageY||t.originalEvent.touches[0].pageY)-this._startY,(this._left<0?-1*this._left:this._left)<(this._top<0?-1*this._top:this._top)||this._scroll?(this._left=0,this._drag=!1,this._scroll=!0):(t.preventDefault(),this._drag=!0,this._scroll=!1,this.position(t));for(var s=0;s<this._len;++s){var i=this._start[s]+this._left;if(this.opts.supportsCssTransitions&&this.opts.transition){var e="translate3d("+i+"px,0,0)";this._list.eq(s).css({left:"","-moz-transition":"0ms","-moz-transform":e,"-ms-transition":"0ms","-ms-transform":e,"-webkit-transition":"0ms","-webkit-transform":e,transition:"0ms",transform:e})}else this._list.eq(s).css("left",i+"px");this._pos[s]=i}}},touchend:function(t){if("touchend"==t.type&&t.originalEvent.touches.length<=1||"dragend"==t.type){if(this._scroll)return this._drag=!1,this._scroll=!1;this.animate(this.direction()),this._drag=!1,this._scroll=!1}},position:function(t){var s=this._view*this._item_w;if(-1==t||1==t){this._startX=0,this._start=[];for(var i=0;i<this._len;++i)this._start[i]=this._pos[i];this._left=t*s}else this._left>s&&(this._left=s),this._left<-s&&(this._left=-s);if(this.opts.roll){var e=[];for(i=0;i<this._len;++i)e[i]=this._pos[i];e.sort(function(t,s){return t-s});var n=e[this._len-this._view],h=_.inArray(e[0],this._pos),r=_.inArray(n,this._pos);if(this._view<=1&&(n=this._len-1),this.opts.multi){if(1==t&&0<=e[0]||this._drag&&100<=e[0])for(i=0;i<this._view;++i,++h,++r)this._start[r]=this._start[h]-s,this._list.eq(r).css("left",this._start[r]+"px");else if(-1==t&&e[0]<=0||this._drag&&e[0]<=-100)for(i=0;i<this._view;++i,++h,++r)this._start[h]=this._start[r]+s,this._list.eq(h).css("left",this._start[h]+"px")}else if(1==t&&0<=e[0]||this._drag&&0<e[0])for(i=0;i<this._view;++i,++h,++r)this._start[r]=this._start[h]-s,this._list.eq(r).css("left",this._start[r]+"px");else if(-1==t&&e[n]<=0||this._drag&&e[n]<=0)for(i=0;i<this._view;++i,++h,++r)this._start[h]=this._start[r]+s,this._list.eq(h).css("left",this._start[h]+"px")}else this.limit_chk()&&(this._left=this._left/2)},animate:function(t,n){if(this._drag||!this._scroll||n){var h=this,r=this._speed;n&&this.position(t);var o=t*(this._item_w*this._view);(0==this._left||!this.opts.roll&&this.limit_chk())&&(o=0),this._list.each(function(t,s){if(h._pos[t]=h._start[t]+o,h.opts.supportsCssTransitions&&h.opts.transition){var i=r+"ms",e="translate3d("+h._pos[t]+"px,0,0)";n&&(i="0ms"),_(this).css({left:"","-moz-transition":i,"-moz-transform":e,"-ms-transition":i,"-ms-transform":e,"-webkit-transition":i,"-webkit-transform":e,transition:i,transform:e})}else _(this).stop(),_(this).animate({left:h._pos[t]+"px"},r)}),this.counter()}},direction:function(){var t=0;return this._left<-this._range?t=-1:this._left>this._range&&(t=1),this._drag&&!this._scroll||(t=0),t},limit_chk:function(){var t=parseInt((this._len-1)/this._view)*this._view;return 0==this._start[0]&&0<this._left||0==this._start[t]&&this._left<0},go_page:function(t,s){for(var i=_.inArray(0,this._pos)/this._view+1-(t+1);0!=i;)i<0?(this.animate(-1,!0),i++):0<i&&(this.animate(1,!0),i--)},counter:function(){if("function"==typeof this.opts.counter){var t={total:Math.ceil(this._len/this._view),current:_.inArray(0,this._pos)/this._view+1};this.opts.counter(t)}}}}(jQuery);