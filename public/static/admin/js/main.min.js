"use strict";function handleAjax(t){t.url&&(t.msg+="，页面即将跳转～"),1==t.code?toast.success(t.msg,"success"):toast.error(t.msg,"danger");"refresh"==t.url?setTimeout(function(){location.href=location.href},1500):t.url&&setTimeout(function(){location.href=t.url},1500)}$(function(){$(".ajax-get").click(function(){var t,e=this;return $(this).hasClass("confirm")&&!confirm("确认要执行该操作吗?")||((t=$(this).attr("href"))||(t=$(this).attr("url")))&&$.get(t).success(function(t){1==t.code?(t.url?toast.success(t.msg+" 页面即将自动跳转~","success"):toast.success(t.msg,"success"),setTimeout(function(){t.url?location.href=t.url:$(e).hasClass("no-refresh")?$("#top-alert").find("button").click():location.reload()},3e3)):(toast.error(t.msg),setTimeout(function(){t.url?location.href=t.url:$("#top-alert").find("button").click()},15e3))}),!1}),$(".ajax-post").click(function(){var t,e,i;toast.showLoading();var s=$(this).attr("target-form"),n=this,r=!1;if("submit"==$(this).attr("type")||(t=$(this).attr("href"))||(t=$(this).attr("url"))){if(i=$("."+s),"true"===$(this).attr("hide-data"))e=(i=$(".hide-data")).serialize();else{if(null==i.get(0))return toast.error("没有可操作数据。","danger"),!1;if("FORM"==i.get(0).nodeName){if($(this).hasClass("confirm"))if(a=(a=$(n).attr("confirm-info"))||"确认要执行该操作吗?",!confirm(a))return toast.hideLoading(),!1;t=void 0!==$(this).attr("url")?$(this).attr("url"):i.get(0).action,e=i.serialize()}else if("INPUT"==i.get(0).nodeName||"SELECT"==i.get(0).nodeName||"TEXTAREA"==i.get(0).nodeName){if(i.each(function(t,e){"checkbox"==e.type&&1==e.checked&&(r=!0)}),r&&$(this).hasClass("confirm"))if(a=(a=$(n).attr("confirm-info"))||"确认要执行该操作吗?",!confirm(a))return toast.hideLoading(),!1;e=i.serialize()}else{var a;if($(this).hasClass("confirm"))if(a=(a=$(n).attr("confirm-info"))||"确认要执行该操作吗?",!confirm(a))return toast.hideLoading(),!1;e=i.find("input,select,textarea").serialize()}}if(""==e&&"true"!=$(this).attr("hide-data"))return toast.hideLoading(),toast.error("请勾选操作对象!。","danger"),!1;$(n).addClass("disabled").attr("autocomplete","off").prop("disabled",!0),$.post(t,e).success(function(t){1==t.code?(t.url?toast.success(t.msg+" 页面即将自动跳转~","success"):toast.success(t.msg,"success"),setTimeout(function(){t.url?location.href=t.url:$(n).hasClass("no-refresh")?($("#top-alert").find("button").click(),$(n).removeClass("disabled").prop("disabled",!1)):location.reload()},1500)):(toast.error(t.msg,"error"),setTimeout(function(){t.url?location.href=t.url:($("#top-alert").find("button").click(),$(n).removeClass("disabled").prop("disabled",!1))},1500))}),toast.hideLoading()}return!1}),$(document).on("submit","form.ajax-form",function(t){t.preventDefault();var e=$(this).attr("data-confirm"),s=$(this);if(e){if(!confirm("确认要执行该操作吗?"))return!1;i()}else i();function i(){$("[type=submit]",s).addClass("disabled");var t=s.attr("action"),e=s.attr("method");if(!t)return!1;e||(e="get");var i=s.serialize();("post"==e?$.post:$.get)(t,i,function(t){handleAjax(t),$("[type=submit]",s).removeClass("disabled")})}return!1})}),function(s,t,e){if(void 0===s)throw new Error("muu requires jQuery");s.muu||(s.muu=function(t){s.isPlainObject(t)&&s.extend(s.muu,t)});var n=function(){s(".nav-type").unbind("change"),s(".nav-type").change(function(){var t=s(this);switch(t.val()){case"module":t.closest("li>div").children("select.module").show().change(),t.closest("li>div").children("input.url").hide();break;case"custom":t.closest("li>div").children("select.module").hide(),t.closest("li>div").children("input.url").show(),t.closest("li>div").children("input.title").val(""),t.closest("li>div").children("input.url").val("")}}),s(".module").unbind("change"),s(".module").change(function(){var t=s(this),e=t.find("option:selected").text(),i=t.val();t.closest("li>div").children("input.title").val(e),t.closest("li>div").children("input.url").val(i),t.closest("li>div").next().children("select.chosen-icons").attr("data-value","icon-"+t.find("option:selected").data("icon")),n()}),s(".add-new").unbind("click"),s(".add-new").click(function(){s(".channel-ul").append(s("#one-nav").html()),n()}),s(".add-one").unbind("click"),s(".add-one").click(function(){s(this).closest(".pLi").after(s("#one-nav").html()),n()}),s(".add-two").unbind("click"),s(".add-two").click(function(){s(this).closest("li").after(s("#two-nav").html()),n()}),s(".remove-li").unbind("click"),s(".remove-li").click(function(){1<s(this).parents("form").find(".pLi").length?(s(this).closest("li").remove(),n()):toast.error("不能再减了~")}),s(".add-child").unbind("click"),s(".add-child").click(function(){0==s(this).closest("li").find(".ul-2").length&&s(this).closest("li").append('<div class="clearfix"></div><ul class="ul-2"  style="display: block;"></ul>'),s(this).closest("li").find(".ul-2").prepend(s("#two-nav").html()),n()}),s(".channel-ul .pLi").each(function(t,e){s(this).attr("data-id",t),s(this).find(".sort").val(s(this).attr("data-order"))}),s(".ul-2 li").each(function(t,e){s(this).find(".pid").val(s(this).parents(".pLi").attr("data-id")),s(this).find(".sort").val(s(this).attr("data-order"))}),s(".target").change(function(){s(this).closest(".new-blank").find(".target_input").val(s(this).is(":checked")?1:0)})};n();s.muu({channel_sort:function(){s(".channel-ul").sortable({trigger:".sort-handle-1",selector:"li",dragCssClass:"",finish:function(){n()}}),s(".channel-ul .ul-2").sortable({trigger:".sort-handle-2",selector:"li",dragCssClass:"",finish:function(){n()}})},channel_bind_color:function(){s(".simpleColorContainer").remove(),s(".simple_color_callback").simpleColor({boxWidth:15,boxHeight:15,cellWidth:15,cellHeight:15,chooserCSS:{"z-index":1200},displayCSS:{border:0}})}})}(jQuery,window),$(function(){$(".check-all").click(function(){$(".ids").prop("checked",this.checked)}),$(".ids").click(function(){$(".ids").each(function(t){if(!this.checked)return $(".check-all").prop("checked",!1),!1;$(".check-all").prop("checked",!0)})}),$(".text").focus(function(){$(this).addClass("focus")}).blur(function(){$(this).removeClass("focus")}),$("textarea").focus(function(){$(this).closest(".textarea").addClass("focus")}).blur(function(){$(this).closest(".textarea").removeClass("focus")})});var admin_image={removeImage:function(t,e){this.upAttachVal("del",e,t),t.parents(".each").remove()},upAttachVal:function(t,e,i){var s=i.parents(".controls").find(".attach"),n=s.val().split(","),r=[];for(var a in n)""!==n[a]&&n[a]!==e.toString()&&r.push(n[a]);return"add"===t&&r.push(e),s.val(r.join(",")),r}},moduleManager={install:function(t){$.post(Url("admin/module/install"),{id:t},function(t){handleAjax(t)})},uninstall:function(t){$.post(Url("admin/module/uninstall"),{id:t},function(t){handleAjax(t)})}};function Url(t,e,i){var s="/index.php";return""!=(t=t.split("/"))[0]&&"@"!=t[0]||(t[0]=APPNAME),t[1]||(t[1]="Index"),t[2]||(t[2]="index"),s=s+"?s=/"+t[0]+"/"+t[1]+"/"+t[2],e&&(s=s+"/"+(e=e.join("/"))),i||(s+=".html"),s}var toast={success:function(t){toast.show(t,{placement:"center",type:"success",close:!0})},error:function(t){toast.show(t,{placement:"center",type:"danger",close:!0})},info:function(t){toast.show(t,{placement:"center",type:"info",close:!0})},warning:function(t,e){toast.show(t,{placement:"center",type:"warning",close:!0})},show:function(t,e){$.zui?$.zui.messager.show(t,e):$.messager.show(t,e)},showLoading:function(){$("body").append('<div class="big_loading"><img src="/static/common/images/big_loading.gif"/></div>')},hideLoading:function(){$("div").remove(".big_loading")}};!function(a){var t=window.Think={};t||a.error("ThinkPHP基础配置没有正确加载！"),t.parse_url=function(t){var e=t.match(/^(?:([a-z]+):\/\/)?([\w-]+(?:\.[\w-]+)+)?(?::(\d+))?([\w-\/]+)?(?:\?((?:\w+=[^#&=\/]*)?(?:&\w+=[^#&=\/]*)*))?(?:#([\w-]+))?$/i);return e||a.error("url格式不正确！"),{scheme:e[1],host:e[2],port:e[3],path:e[4],query:e[5],fragment:e[6]}},t.parse_str=function(t){var e,i=t.split("&"),s={};for(val in i)s[(e=i[val].split("="))[0]]=e[1];return s},t.parse_name=function(t,e){return e?(t.replace(/_([a-z])/g,function(t,e){return e.toUpperCase()}),t.replace(/[a-z]/,function(t){return t.toUpperCase()})):0===(t=t.replace(/[A-Z]/g,function(t){return"_"+t.toLowerCase()})).indexOf("_")&&(t=t.substr(1)),t},t.Url=function(t,e,i){var s=this.parse_url(t),n=[],r={};return s.path||a.error("url格式错误！"),t=0===(t=s.path).indexOf("/")?(0==this.MODEL[0]&&a.error("该URL模式不支持使用路由!("+t+")"),"/"==t.substr(-1)&&(t=t.substr(0,t.length-1)),"/"+(t="/"==this.DEEP?t.substr(1):t.substr(1).replace(/\//g,this.DEEP))):((n=[(n=t.split("/")).pop(),n.pop(),n.pop()].reverse())[1]||a.error("ThinkPHP.Url("+t+")没有指定控制器"),n[0]&&(r[this.VAR[0]]=this.MODEL[1]?n[0].toLowerCase():n[0]),r[this.VAR[1]]=this.MODEL[1]?this.parse_name(n[1]):n[1],r[this.VAR[2]]=n[2].toLowerCase(),"?"+a.param(r)),"string"==typeof e?e=this.parse_str(e):a.isPlainObject(e)||(e={}),s.query&&a.extend(e,this.parse_str(s.query)),e&&(t+="&"+a.param(e)),0!=this.MODEL[0]&&(t=t.replace("?"+(n[0]?this.VAR[0]:this.VAR[1])+"=","/").replace("&"+this.VAR[1]+"=",this.DEEP).replace("&"+this.VAR[2]+"=",this.DEEP).replace(/(\w+=&)|(&?\w+=$)/g,"").replace(/[&=]/g,this.DEEP),!1!==i&&(i=i||this.MODEL[2].split("|")[0])&&(t+="."+i)),t=this.APP+t},t.setValue=function(t,e){var i,s,n=t.substr(0,1),r=0;if(""!==e)if((i=a("#"===n||"."===n?t:"[name='"+t+"']")).eq(0).is(":radio"))i.filter("[value='"+e+"']").each(function(){this.checked=!0});else if(i.eq(0).is(":checkbox"))for(a.isArray(e)?s=e:(s=new Array)[0]=e,r=0,len=s.length;r<len;r++)i.filter("[value='"+s[r]+"']").each(function(){this.checked=!0});else i.val(e)}}(jQuery);