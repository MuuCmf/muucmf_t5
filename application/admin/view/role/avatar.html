{extend name="common/main" /}
{block name="body"}
<style>
.avatar {
    float:left;
    margin-right:10px;
}
</style>
    <div class="main-title">
        <h2>{:lang("_DEFAULT_AVATAR_CONFIGURATION_")}</h2>
    </div>

    <div class="with-padding">
        <div class="tab-wrap row clearfix">
            <div class="col-xs-10">
                {include file="role/_link"/}
            </div>
            <div class="col-xs-2 text-right">
                <select name="role" class="form-control">
                    {volist name="role_list" id="vo"}
                        <option value="{:Url('Role/configavatar',array('id'=>$vo['id']))}" {eq name="vo['id']" value="$this_role['id']"}selected{/eq}>{$vo.title}</option>
                    {/volist}
                </select>
            </div>
        </div>
        <form action="{:url()}" enctype="application/x-www-form-urlencoded" method="POST" class="form-horizontal avatar-form ajax-form">
            <input type="hidden" name="id" value="{$this_role.id}"/>
            <input class="attach" type="hidden" name="avatar_id" value="{$this_role.avatar}"/>
            <input class="attach" type="hidden" name="set_null" value="0"/>
            <label class="item-label" style="font-size: 15px;font-weight: 400;">{:lang("_UPLOAD_DEFAULT_AVATAR_")}<span style="font-size: 12px;margin-left: 20px;color: rgb(253, 67, 67);">{:lang("_PLEASE_UPLOAD_256PX_")}*256px的pn{:lang("_G_AVATAR_")}</span></label>
            <div class="controls">
                <div id="upload_single_image" style="padding-bottom: 5px;">{:lang("_SELECT_PICTURES_")}</div>
                {if condition="!isset($this_role['avatar'])"}
                    <div data-role="avatar-block" style="display:none;">

                        <div class="avatar">
                            <a href="{$this_role.avatar|getThumbImageById='256','256'}" data-role="avatar256" title={:lang("_CLICK_TO_SEE_THE_BIG_PICTURE_WITH_DOUBLE_")}>
                                <img src="{$this_role.avatar|getThumbImageById='256','256'}">
                            </a>
                            <div class="img_tips">256px*256px</div>
                        </div>
                        <div class="avatar">
                            <a href="{$this_role.avatar|getThumbImageById='128','128'}" data-role="avatar128" title={:lang("_CLICK_TO_SEE_THE_BIG_PICTURE_WITH_DOUBLE_")}>
                                <img src="{$this_role.avatar|getThumbImageById='128','128'}">
                            </a>
                            <div class="img_tips">128px*128px</div>
                        </div>
                        <div class="avatar">
                            <a href="{$this_role.avatar|getThumbImageById='64','64'}" data-role="avatar64" title={:lang("_CLICK_TO_SEE_THE_BIG_PICTURE_WITH_DOUBLE_")}>
                                <img src="{$this_role.avatar|getThumbImageById='64','64'}">
                            </a>
                            <div class="img_tips">64px*64px</div>
                        </div>
                        <div class="avatar">
                            <a href="{$this_role.avatar|getThumbImageById='32','32'}" data-role="avatar32" title={:lang("_CLICK_TO_SEE_THE_BIG_PICTURE_WITH_DOUBLE_")}>
                                <img src="{$this_role.avatar|getThumbImageById='32','32'}">
                            </a>
                            <div class="img_tips">32px*32px</div>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                {else/}
                    <div data-role="avatar-block">
                        <div class="avatar">
                            <a href="{$this_role.avatar|getThumbImageById='256','256'}" data-role="avatar256" title={:lang("_CLICK_TO_SEE_THE_BIG_PICTURE_WITH_DOUBLE_")}>
                                <img src="{$this_role.avatar|getThumbImageById='256','256'}">
                            </a>
                            <div class="img_tips">256px*256px</div>
                        </div>
                        <div class="avatar" style="margin-top: 20px;">
                            <a href="{$this_role.avatar|getThumbImageById='128','128'}" data-role="avatar128" title={:lang("_CLICK_TO_SEE_THE_BIG_PICTURE_WITH_DOUBLE_")}>
                                <img src="{$this_role.avatar|getThumbImageById='128','128'}">
                            </a>
                            <div class="img_tips">128px*128px</div>
                        </div>
                        <div class="avatar" style="margin-top: 40px;">
                            <a href="{$this_role.avatar|getThumbImageById='64','64'}" data-role="avatar64" title={:lang("_CLICK_TO_SEE_THE_BIG_PICTURE_WITH_DOUBLE_")}>
                                <img src="{$this_role.avatar|getThumbImageById='64','64'}">
                            </a>
                            <div class="img_tips">64px*64px</div>
                        </div>
                        <div class="avatar" style="margin-top: 52px;">
                            <a href="{$this_role.avatar|getThumbImageById='32','32'}" data-role="avatar32" title={:lang("_CLICK_TO_SEE_THE_BIG_PICTURE_WITH_DOUBLE_")}>
                                <img src="{$this_role.avatar|getThumbImageById='32','32'}">
                            </a>
                            <div class="img_tips">32px*32px</div>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                {/if}

            </div>
            <br/>

            <div class="form-item">
                <div style="margin-top: 20px;"></div>

                <button type="submit" class="btn submit-btn ajax-post" target-form="avatar-form" data-role="submit_button" style="display: none;">{:lang("_SURE_WITH_SPACE_")}</button>

                <button class="btn submit-btn" data-role="do_submit">{:lang("_SURE_WITH_SPACE_")}</button>
                <button class="btn btn-return" onclick="javascript:history.back(-1);return false;">{:lang("_RETURN_WITH_SPACE_")}</button>
                <button class="btn submit-btn" data-role="set_null">{:lang("_USE_SYSTEM_DEFAULT_AVATAR_")}</button>
                <span style="color: #BABABA;margin: 11px;">{:lang("_PLEASE_SAVE_THE_ABOVE_CONFIGURATION_AND_THEN_SWITCH_TO_ANOTHER_INTERFACE_")}</span>
            </div>
        </form>

    </div>

{/block}

{block name="script"}
    <script type="text/javascript" charset="utf-8" src="__COMMON__/lib/webuploader/js/webuploader.js"></script>
    <link href="__COMMON__/lib/webuploader/css/webuploader.css" type="text/css" rel="stylesheet">

    <script type="text/javascript">
        $(function () {
            $('[data-role="set_null"]').click(function(){
                $('[name="set_null"]').val(1);
                $('[data-role="submit_button"]').click();
                return false;
            });

            $('[data-role="do_submit"]').click(function(){
                $('[name="set_null"]').val(0);
                $('[data-role="submit_button"]').click();
                return false;
            });

            var uploader= WebUploader.create({
                // 选完文件后，是否自动上传。
                auto: true,
                // swf文件路径
                swf: 'Uploader.swf',
                // 文件接收服务端。
                server: "{:Url('role/uploadPicture',array('session_id'=>session_id()))}",
                // 选择文件的按钮。可选。
                // 内部根据当前运行是创建，可能是input元素，也可能是flash.
                pick: '#upload_single_image',
                // 只允许选择图片文件。
                accept: {
                    title: 'Images',
                    extensions: 'gif,jpg,jpeg,bmp,png',
                    mimeTypes: 'image/*'
                }
            });
            uploader.on('fileQueued', function (file) {
                uploader.upload();
            });
            /*上传成功*/
            uploader.on('uploadSuccess', function (file, data) {
                if (data.code == 1) {
                    
                    var info = data.data[0];
                    console.log(info);
                    $('[data-role="avatar-block"]').show();

                    $('[name="avatar_id"]').val(info.id);
                    $('[data-role="avatar256"]').find('img').attr('src',info.path256);
                    $('[data-role="avatar128"]').find('img').attr('src',info.path128);
                    $('[data-role="avatar64"]').find('img').attr('src',info.path64);
                    $('[data-role="avatar32"]').find('img').attr('src',info.path32);
                    uploader.reset();
                } else {
                    updateAlert(data.msg);
                    setTimeout(function () {
                        $('#top-alert').find('button').click();
                        $(that).removeClass('disabled').prop('disabled', false);
                    }, 1500);
                }
            });
            $('select[name="role"]').change(function(){
                location.href = this.value;
            });
        })
    </script>
    
    

{/block}
